{% doc %}
  @prompt
    Create a Watch And Shop video carousel section. Show 4 product video cards in a horizontal scrolling carousel. Each card contains: a video element with controls that accepts video files from Shopify Files or media library, the video should be 9:16 aspect ratio with max-height of 500px and width auto-calculated to maintain ratio, product title text field below video, current price field, original price field with strikethrough, discount percentage badge in green. Include schema settings for each video card with: video picker from Shopify Files, text input for product title, number inputs for prices, text input for discount percentage, URL picker for product link. Add infinite loop carousel functionality with left and right arrow buttons. Make it responsive showing 4 cards on desktop, 2-3 on tablet, 1-2 on mobile. Videos should have autoplay muted and loop attributes. Use clean modern styling matching theme design.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-video-carousel-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    overflow: hidden;
    padding: 40px 0;
  }

  .ai-video-carousel__header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 32px;
  }

  .ai-video-carousel__title-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0;
  }

  .ai-video-carousel__container-{{ ai_gen_id }} {
    position: relative;
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-video-carousel__track-wrapper-{{ ai_gen_id }} {
    overflow: hidden;
    position: relative;
  }

  .ai-video-carousel__track-{{ ai_gen_id }} {
    display: flex;
    gap: 20px;
    transition: transform 0.5s ease;
  }

  .ai-video-carousel__card-{{ ai_gen_id }} {
    flex: 0 0 calc(25% - 15px);
    min-width: 0;
  }

  .ai-video-carousel__card-inner-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .ai-video-carousel__card-inner-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  .ai-video-carousel__video-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    aspect-ratio: 9 / 16;
    max-height: 500px;
    background: #000;
    overflow: hidden;
  }

  .ai-video-carousel__video-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-video-carousel__discount-badge-{{ ai_gen_id }} {
    position: absolute;
    top: 12px;
    right: 12px;
    background: {{ block.settings.discount_badge_color }};
    color: {{ block.settings.discount_badge_text_color }};
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    z-index: 2;
  }

  .ai-video-carousel__content-{{ ai_gen_id }} {
    padding: 16px;
  }

  .ai-video-carousel__product-title-{{ ai_gen_id }} {
    font-size: 16px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .ai-video-carousel__price-wrapper-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .ai-video-carousel__current-price-{{ ai_gen_id }} {
    font-size: 18px;
    font-weight: 700;
    color: {{ block.settings.price_color }};
  }

  .ai-video-carousel__original-price-{{ ai_gen_id }} {
    font-size: 16px;
    color: {{ block.settings.original_price_color }};
    text-decoration: line-through;
    opacity: 0.7;
  }

  .ai-video-carousel__nav-button-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: {{ block.settings.arrow_background }};
    color: {{ block.settings.arrow_color }};
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .ai-video-carousel__nav-button-{{ ai_gen_id }}:hover {
    background: {{ block.settings.arrow_hover_background }};
    transform: translateY(-50%) scale(1.1);
  }

  .ai-video-carousel__nav-button-{{ ai_gen_id }}:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .ai-video-carousel__nav-button--prev-{{ ai_gen_id }} {
    left: -24px;
  }

  .ai-video-carousel__nav-button--next-{{ ai_gen_id }} {
    right: -24px;
  }

  .ai-video-carousel__nav-button-{{ ai_gen_id }} svg {
    width: 24px;
    height: 24px;
  }

  .ai-video-carousel__empty-state-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }

  .ai-video-carousel__empty-state-{{ ai_gen_id }} p {
    font-size: 16px;
    margin: 0;
  }

  @media screen and (max-width: 989px) {
    .ai-video-carousel__card-{{ ai_gen_id }} {
      flex: 0 0 calc(33.333% - 14px);
    }
  }

  @media screen and (max-width: 749px) {
    .ai-video-carousel__card-{{ ai_gen_id }} {
      flex: 0 0 calc(50% - 10px);
    }

    .ai-video-carousel__nav-button--prev-{{ ai_gen_id }} {
      left: 10px;
    }

    .ai-video-carousel__nav-button--next-{{ ai_gen_id }} {
      right: 10px;
    }

    .ai-video-carousel__title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.heading_size }}px * 0.8);
    }
  }

  @media screen and (max-width: 480px) {
    .ai-video-carousel__card-{{ ai_gen_id }} {
      flex: 0 0 calc(100% - 40px);
    }
  }
{% endstyle %}

<video-carousel-{{ ai_gen_id }} class="ai-video-carousel-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% if block.settings.heading != blank %}
    <div class="ai-video-carousel__header-{{ ai_gen_id }}">
      <h2 class="ai-video-carousel__title-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
    </div>
  {% endif %}

  <div class="ai-video-carousel__container-{{ ai_gen_id }}">
    {% assign has_content = false %}
    {% for i in (1..4) %}
      {% liquid
        assign video_key = 'video_' | append: i
        assign video = block.settings[video_key]
        if video != blank
          assign has_content = true
          break
        endif
      %}
    {% endfor %}

    {% if has_content %}
      <div class="ai-video-carousel__track-wrapper-{{ ai_gen_id }}">
        <div class="ai-video-carousel__track-{{ ai_gen_id }}" data-track>
          {% for i in (1..4) %}
            {% liquid
              assign video_key = 'video_' | append: i
              assign title_key = 'product_title_' | append: i
              assign current_price_key = 'current_price_' | append: i
              assign original_price_key = 'original_price_' | append: i
              assign discount_key = 'discount_percentage_' | append: i
              assign link_key = 'product_link_' | append: i

              assign video = block.settings[video_key]
              assign title = block.settings[title_key]
              assign current_price = block.settings[current_price_key]
              assign original_price = block.settings[original_price_key]
              assign discount = block.settings[discount_key]
              assign link = block.settings[link_key]
            %}

            {% if video != blank %}
              <div class="ai-video-carousel__card-{{ ai_gen_id }}">
                <a href="{{ link | default: '#' }}" class="ai-video-carousel__card-inner-{{ ai_gen_id }}">
                  <div class="ai-video-carousel__video-wrapper-{{ ai_gen_id }}">
                    <video
                      class="ai-video-carousel__video-{{ ai_gen_id }}"
                      src="{{ video }}"
                      autoplay
                      muted
                      loop
                      playsinline
                      controls
                    ></video>
                    {% if discount != blank %}
                      <div class="ai-video-carousel__discount-badge-{{ ai_gen_id }}">
                        {{ discount }}
                      </div>
                    {% endif %}
                  </div>
                  <div class="ai-video-carousel__content-{{ ai_gen_id }}">
                    {% if title != blank %}
                      <h3 class="ai-video-carousel__product-title-{{ ai_gen_id }}">{{ title }}</h3>
                    {% endif %}
                    <div class="ai-video-carousel__price-wrapper-{{ ai_gen_id }}">
                      {% if current_price != blank %}
                        <span class="ai-video-carousel__current-price-{{ ai_gen_id }}">₹{{ current_price }}</span>
                      {% endif %}
                      {% if original_price != blank %}
                        <span class="ai-video-carousel__original-price-{{ ai_gen_id }}">₹{{ original_price }}</span>
                      {% endif %}
                    </div>
                  </div>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <button
        class="ai-video-carousel__nav-button-{{ ai_gen_id }} ai-video-carousel__nav-button--prev-{{ ai_gen_id }}"
        data-prev
        aria-label="Previous"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <button
        class="ai-video-carousel__nav-button-{{ ai_gen_id }} ai-video-carousel__nav-button--next-{{ ai_gen_id }}"
        data-next
        aria-label="Next"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    {% else %}
      <div class="ai-video-carousel__empty-state-{{ ai_gen_id }}">
        <p>Add videos to your carousel to get started</p>
      </div>
    {% endif %}
  </div>
</video-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class VideoCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.track = this.querySelector('[data-track]');
        this.prevButton = this.querySelector('[data-prev]');
        this.nextButton = this.querySelector('[data-next]');
        this.cards = this.querySelectorAll('.ai-video-carousel__card-{{ ai_gen_id }}');
        this.autoplayInterval = null;
      }

      connectedCallback() {
        if (!this.track || this.cards.length === 0) return;

        this.setupEventListeners();
        this.updateButtons();
        this.cloneCards();
        this.startAutoplay();
      }

      disconnectedCallback() {
        this.stopAutoplay();
      }

      cloneCards() {
        const firstClones = Array.from(this.cards).map(card => card.cloneNode(true));
        const lastClones = Array.from(this.cards).map(card => card.cloneNode(true));

        firstClones.forEach(clone => this.track.appendChild(clone));
        lastClones.reverse().forEach(clone => this.track.insertBefore(clone, this.track.firstChild));

        this.currentIndex = this.cards.length;
        this.updateTrackPosition(false);
      }

      setupEventListeners() {
        this.prevButton.addEventListener('click', () => this.prev());
        this.nextButton.addEventListener('click', () => this.next());

        this.addEventListener('mouseenter', () => this.stopAutoplay());
        this.addEventListener('mouseleave', () => this.startAutoplay());

        this.track.addEventListener('transitionend', () => {
          if (this.currentIndex >= this.cards.length * 2) {
            this.currentIndex = this.cards.length;
            this.updateTrackPosition(false);
          } else if (this.currentIndex < this.cards.length) {
            this.currentIndex = this.cards.length * 2 - 1;
            this.updateTrackPosition(false);
          }
        });
      }

      getVisibleCards() {
        const width = window.innerWidth;
        if (width <= 480) return 1;
        if (width <= 749) return 2;
        if (width <= 989) return 3;
        return 4;
      }

      updateTrackPosition(animate = true) {
        const cardWidth = this.cards[0].offsetWidth;
        const gap = 20;
        const offset = this.currentIndex * (cardWidth + gap);

        if (!animate) {
          this.track.style.transition = 'none';
        } else {
          this.track.style.transition = 'transform 0.5s ease';
        }

        this.track.style.transform = `translateX(-${offset}px)`;

        if (!animate) {
          this.track.offsetHeight;
          this.track.style.transition = 'transform 0.5s ease';
        }
      }

      next() {
        this.currentIndex++;
        this.updateTrackPosition();
        this.updateButtons();
      }

      prev() {
        this.currentIndex--;
        this.updateTrackPosition();
        this.updateButtons();
      }

      updateButtons() {
        this.prevButton.disabled = false;
        this.nextButton.disabled = false;
      }

      startAutoplay() {
        if (this.cards.length <= 1) return;
        this.stopAutoplay();
        this.autoplayInterval = setInterval(() => this.next(), 3000);
      }

      stopAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }
    }

    customElements.define('video-carousel-{{ ai_gen_id }}', VideoCarousel{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Watch and shop carousel",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Watch & Shop"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 36
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#5f0511"
    },
    {
      "type": "header",
      "content": "Video card 1"
    },
    {
      "type": "video",
      "id": "video_1",
      "label": "Video"
    },
    {
      "type": "text",
      "id": "product_title_1",
      "label": "Product title"
    },
    {
      "type": "text",
      "id": "current_price_1",
      "label": "Current price"
    },
    {
      "type": "text",
      "id": "original_price_1",
      "label": "Original price"
    },
    {
      "type": "text",
      "id": "discount_percentage_1",
      "label": "Discount badge"
    },
    {
      "type": "url",
      "id": "product_link_1",
      "label": "Product link"
    },
    {
      "type": "header",
      "content": "Video card 2"
    },
    {
      "type": "video",
      "id": "video_2",
      "label": "Video"
    },
    {
      "type": "text",
      "id": "product_title_2",
      "label": "Product title"
    },
    {
      "type": "text",
      "id": "current_price_2",
      "label": "Current price"
    },
    {
      "type": "text",
      "id": "original_price_2",
      "label": "Original price"
    },
    {
      "type": "text",
      "id": "discount_percentage_2",
      "label": "Discount badge"
    },
    {
      "type": "url",
      "id": "product_link_2",
      "label": "Product link"
    },
    {
      "type": "header",
      "content": "Video card 3"
    },
    {
      "type": "video",
      "id": "video_3",
      "label": "Video"
    },
    {
      "type": "text",
      "id": "product_title_3",
      "label": "Product title"
    },
    {
      "type": "text",
      "id": "current_price_3",
      "label": "Current price"
    },
    {
      "type": "text",
      "id": "original_price_3",
      "label": "Original price"
    },
    {
      "type": "text",
      "id": "discount_percentage_3",
      "label": "Discount badge"
    },
    {
      "type": "url",
      "id": "product_link_3",
      "label": "Product link"
    },
    {
      "type": "header",
      "content": "Video card 4"
    },
    {
      "type": "video",
      "id": "video_4",
      "label": "Video"
    },
    {
      "type": "text",
      "id": "product_title_4",
      "label": "Product title"
    },
    {
      "type": "text",
      "id": "current_price_4",
      "label": "Current price"
    },
    {
      "type": "text",
      "id": "original_price_4",
      "label": "Original price"
    },
    {
      "type": "text",
      "id": "discount_percentage_4",
      "label": "Discount badge"
    },
    {
      "type": "url",
      "id": "product_link_4",
      "label": "Product link"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 18
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#5f0511"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Current price color",
      "default": "#5f0511"
    },
    {
      "type": "color",
      "id": "original_price_color",
      "label": "Original price color",
      "default": "#5f0511"
    },
    {
      "type": "color",
      "id": "discount_badge_color",
      "label": "Discount badge background",
      "default": "#008060"
    },
    {
      "type": "color",
      "id": "discount_badge_text_color",
      "label": "Discount badge text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_background",
      "label": "Arrow background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow color",
      "default": "#5f0511"
    },
    {
      "type": "color",
      "id": "arrow_hover_background",
      "label": "Arrow hover background",
      "default": "#5f0511"
    }
  ],
  "presets": [
    {
      "name": "Watch and shop carousel"
    }
  ]
}
{% endschema %}
